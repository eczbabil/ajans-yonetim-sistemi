{% extends "base.html" %}

{% block title %}Sosyal Medya Ekle - Sisyphos Ajans{% endblock %}

{% block breadcrumb %}
<div class="container-fluid mt-3">
    <div class="breadcrumb-modern">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}"><i class="bi bi-house-door"></i> Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('sosyal_medya') }}">Sosyal Medya</a></li>
                <li class="breadcrumb-item active">Yeni Gönderi</li>
            </ol>
        </nav>
    </div>
</div>
{% endblock %}

{% block content %}
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>Yeni Sosyal Medya Gönderisi Ekle</h3>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="musteri_id" class="form-label">Müşteri *</label>
                                    <select class="form-control" id="musteri_id" name="musteri_id" required onchange="musteriSecildi()">
                                        <option value="">Müşteri seçin...</option>
                                        {% for musteri in musteriler %}
                                        <option value="{{ musteri.id }}" {% if secili_musteri_id == musteri.id %}selected{% endif %}>
                                            {{ musteri.musteri_kodu }} - {{ musteri.ad }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="tarih" class="form-label">Tarih *</label>
                                    <input type="date" class="form-control" id="tarih" name="tarih" required>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="is_gunlugu_id" class="form-label">İş Seçin (Opsiyonel - İş kodu ile takip için)</label>
                                <select class="form-control" id="is_gunlugu_id" name="is_gunlugu_id">
                                    <option value="">İş seçmeyin (bağımsız kayıt)</option>
                                    {% for is in isler %}
                                    <option value="{{ is.id }}">{{ is.is_kodu }} - {{ is.aciklama[:50] if is.aciklama else is.proje }}</option>
                                    {% endfor %}
                                </select>
                                <small class="text-muted">Bir iş ile ilişkilendirmek isterseniz seçin, yoksa boş bırakın</small>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="platform" class="form-label">Platform *</label>
                                    <select class="form-control" id="platform" name="platform" required>
                                        <option value="">Seçin...</option>
                                        <option value="Instagram">Instagram</option>
                                        <option value="Facebook">Facebook</option>
                                        <option value="Twitter">Twitter</option>
                                        <option value="LinkedIn">LinkedIn</option>
                                        <option value="TikTok">TikTok</option>
                                        <option value="YouTube">YouTube</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="gonderi_turu" class="form-label">Gönderi Türü *</label>
                                    <select class="form-control" id="gonderi_turu" name="gonderi_turu" required>
                                        <option value="">Seçin...</option>
                                        <option value="Post">Post</option>
                                        <option value="Reels">Reels</option>
                                        <option value="Story">Story</option>
                                        <option value="Video">Video</option>
                                        <option value="Fotoğraf">Fotoğraf</option>
                                        <option value="Carousel">Carousel</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="icerik_basligi" class="form-label">İçerik Başlığı *</label>
                                <input type="text" class="form-control" id="icerik_basligi" name="icerik_basligi" required>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <label for="etkilesim" class="form-label">Etkileşim</label>
                                    <input type="number" class="form-control" id="etkilesim" name="etkilesim" value="0">
                                </div>
                                <div class="col-md-3">
                                    <label for="goruntulenme" class="form-label">Görüntülenme</label>
                                    <input type="number" class="form-control" id="goruntulenme" name="goruntulenme" value="0">
                                </div>
                                <div class="col-md-3">
                                    <label for="begeni" class="form-label">Beğeni</label>
                                    <input type="number" class="form-control" id="begeni" name="begeni" value="0">
                                </div>
                                <div class="col-md-3">
                                    <label for="yorum" class="form-label">Yorum</label>
                                    <input type="number" class="form-control" id="yorum" name="yorum" value="0">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="paylasim" class="form-label">Paylaşım</label>
                                    <input type="number" class="form-control" id="paylasim" name="paylasim" value="0">
                                </div>
                                <div class="col-md-6">
                                    <label for="durum" class="form-label">Durum *</label>
                                    <select class="form-control" id="durum" name="durum" required>
                                        <option value="Taslak">Taslak</option>
                                        <option value="Yayınlandı" selected>Yayınlandı</option>
                                        <option value="Planlandı">Planlandı</option>
                                        <option value="İptal Edildi">İptal Edildi</option>
                                    </select>
                                </div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="{{ url_for('sosyal_medya') }}" class="btn btn-secondary me-md-2">İptal</a>
                                <button type="submit" class="btn btn-primary">Gönderi Ekle</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Sayfa yüklendiğinde bugünün tarihini otomatik ayarla
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('tarih').value = today;
    });
    
    // Müşteri seçildiğinde işleri yükle
    function musteriSecildi() {
        const musteriId = document.getElementById('musteri_id').value;
        if (musteriId) {
            // Sayfayı yenile (işleri yüklemek için)
            window.location.href = `/sosyal_medya_ekle/${musteriId}`;
        }
    }
</script>
{% endblock %}
